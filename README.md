# üöÄ ML API FastAPI v2

**API completa para Machine Learning con FastAPI, React y monitoreo en tiempo real**

## üìã Tabla de Contenidos

- [üéØ Descripci√≥n](#-descripci√≥n)
- [üèóÔ∏è Arquitectura](#Ô∏è-arquitectura)
- [üåê Puertos y Servicios](#-puertos-y-servicios)
- [‚ö° Inicio R√°pido](#-inicio-r√°pido)
- [üîß Configuraci√≥n Manual](#-configuraci√≥n-manual)
- [üìñ Documentaci√≥n API](#-documentaci√≥n-api)
- [üé® Frontend](#-frontend)
- [üìä Monitoreo](#-monitoreo)
- [üöÄ Despliegue](#-despliegue)
- [üß™ Testing](#-testing)
- [ü§ù Contribuci√≥n](#-contribuci√≥n)

## üéØ Descripci√≥n

ML API FastAPI v2 es una plataforma completa para desarrollar, desplegar y monitorear modelos de Machine Learning. Incluye:

- **Backend FastAPI** con endpoints REST para predicciones
- **Frontend React** para gestionar modelos y visualizar resultados
- **WebSockets** para actualizaciones en tiempo real
- **Cache Redis** para optimizar rendimiento
- **Base de datos PostgreSQL** para persistencia
- **Monitoreo completo** con Prometheus y Grafana
- **Panel de administraci√≥n** para gesti√≥n avanzada

## üèóÔ∏è Arquitectura

```mermaid
graph TB
    subgraph "üé® Frontend"
        WebApp[Web App React :3000]
        AdminPanel[Admin Panel :3001]
    end

    subgraph "üåê Proxy"
        Nginx[Nginx :80]
    end

    subgraph "‚öôÔ∏è Backend"
        API[FastAPI :8000]
        WS[WebSocket :8001]
    end

    subgraph "üíæ Datos"
        Postgres[(PostgreSQL :5432)]
        Redis[(Redis :6379)]
    end

    subgraph "üìä Monitoreo"
        Prometheus[Prometheus :8002]
        Grafana[Grafana :3000]
    end

    WebApp --> Nginx
    AdminPanel --> Nginx
    Nginx --> API
    Nginx --> WS

    API --> Postgres
    API --> Redis
    WS --> Redis

    API --> Prometheus
    Prometheus --> Grafana
```

## üåê Puertos y Servicios

| Servicio           | Puerto | URL                   | Descripci√≥n                |
| ------------------ | ------ | --------------------- | -------------------------- |
| **Frontend Web**   | 3000   | http://localhost:3000 | üé® App principal React/Vue |
| **Frontend Admin** | 3001   | http://localhost:3001 | üîß Panel administraci√≥n    |
| **Backend API**    | 8000   | http://localhost:8000 | ‚öôÔ∏è FastAPI REST API        |
| **WebSocket**      | 8001   | ws://localhost:8001   | üì° Tiempo real             |
| **Metrics**        | 8002   | http://localhost:8002 | üìä Prometheus metrics      |
| **Grafana**        | 3000   | http://localhost:3000 | üìà Dashboards              |
| **PostgreSQL**     | 5432   | localhost:5432        | üóÑÔ∏è Base de datos           |
| **Redis**          | 6379   | localhost:6379        | ‚ö° Cache                   |
| **Nginx**          | 80     | http://localhost      | üåê Proxy reverso           |

## ‚ö° Inicio R√°pido

### 1Ô∏è‚É£ Configuraci√≥n Autom√°tica

```bash
# Clonar repositorio
git clone <repository-url>
cd ml-api-fastapi-v2

# Ejecutar script de configuraci√≥n
chmod +x infrastructure/scripts/setup.sh
./infrastructure/scripts/setup.sh
```

### 2Ô∏è‚É£ Con Docker (Recomendado)

```bash
# Levantar todos los servicios
docker-compose up -d

# Ver logs
docker-compose logs -f

# Parar servicios
docker-compose down
```

### 3Ô∏è‚É£ Verificar Servicios

```bash
# Health check
curl http://localhost:8000/health

# API docs
open http://localhost:8000/docs

# Frontend
open http://localhost:3000
```

## üîß Configuraci√≥n Manual

### Backend (Python + FastAPI)

```bash
# 1. Crear ambiente virtual
cd backend
python3 -m venv venv

# 2. Activar ambiente virtual
# Linux/Mac:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# 3. Instalar dependencias
pip install -r requirements/base.txt

# 4. Configurar variables de entorno
cp config/local.env .env

# 5. Ejecutar migraciones
alembic upgrade head

# 6. Ejecutar servidor
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### Frontend (React + Vite)

```bash
# 1. Web App
cd frontend/web-app
npm install
npm run dev

# 2. Admin Panel
cd frontend/admin-panel
npm install
npm run dev
```

### Base de Datos

```bash
# PostgreSQL con Docker
docker run -d \
  --name ml-api-postgres \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=ml_api_db \
  -p 5432:5432 \
  postgres:16-alpine

# Redis con Docker
docker run -d \
  --name ml-api-redis \
  -p 6379:6379 \
  redis:7-alpine
```

## üìñ Documentaci√≥n API

### Endpoints Principales

#### üè• Health Check

```http
GET /health              # Health b√°sico
GET /health/detailed     # Health detallado
GET /health/liveness     # Kubernetes liveness
GET /health/readiness    # Kubernetes readiness
```

#### üéØ Predicciones

```http
POST /api/v1/predict/           # Crear predicci√≥n
GET  /api/v1/predict/{id}       # Obtener predicci√≥n
GET  /api/v1/predict/           # Listar predicciones
DELETE /api/v1/predict/{id}     # Eliminar predicci√≥n
POST /api/v1/predict/batch      # Predicciones en lote
```

#### üì¶ Modelos

```http
GET    /api/v1/models/          # Listar modelos
POST   /api/v1/models/          # Crear modelo
GET    /api/v1/models/{id}      # Obtener modelo
PUT    /api/v1/models/{id}      # Actualizar modelo
DELETE /api/v1/models/{id}      # Eliminar modelo
```

#### üì§ Upload

```http
POST /api/v1/upload/            # Subir archivo
POST /api/v1/upload/model       # Subir modelo ML
```

#### üì° WebSocket

```
ws://localhost:8001/ws          # Conexi√≥n WebSocket
```

### Ejemplo de Uso

```python
import requests

# 1. Health check
response = requests.get("http://localhost:8000/health")
print(response.json())

# 2. Crear predicci√≥n
prediction_data = {
    "model_id": "sklearn-model-1",
    "input_data": {
        "feature1": 1.5,
        "feature2": 2.3,
        "feature3": 0.8
    },
    "async_mode": False
}

response = requests.post(
    "http://localhost:8000/api/v1/predict/",
    json=prediction_data
)
print(response.json())
```

## üé® Frontend

### Web App (Puerto 3000)

- **Home**: Dashboard principal con m√©tricas
- **Predict**: Formulario para hacer predicciones
- **Models**: Gesti√≥n de modelos ML
- **Upload**: Subir archivos y modelos
- **Results**: Visualizaci√≥n de resultados

### Admin Panel (Puerto 3001)

- **Dashboard**: M√©tricas del sistema
- **Users**: Gesti√≥n de usuarios
- **Models**: CRUD avanzado de modelos
- **System**: Configuraci√≥n del sistema
- **Logs**: Visualizaci√≥n de logs

### Tecnolog√≠as Frontend

- **React 18** con TypeScript
- **Vite** para build y desarrollo
- **TailwindCSS** para estilos
- **React Query** para estado servidor
- **Zustand** para estado local
- **React Hook Form** para formularios
- **Recharts** para gr√°ficos

## üìä Monitoreo

### Prometheus (Puerto 8002)

- M√©tricas de aplicaci√≥n
- M√©tricas de sistema
- Alertas personalizadas

### Grafana (Puerto 3000)

- Dashboards predefinidos
- Visualizaci√≥n en tiempo real
- Alertas por email/Slack

### M√©tricas Disponibles

- N√∫mero de predicciones
- Tiempo de respuesta
- Uso de CPU y memoria
- Estado de servicios
- Cache hit/miss ratio

## üöÄ Despliegue

### Docker Compose Producci√≥n

```bash
# Archivo: docker-compose.prod.yml
docker-compose -f docker-compose.prod.yml up -d
```

### Kubernetes

```bash
# Aplicar manifiestos
kubectl apply -f infrastructure/k8s/
```

### Variables de Entorno Producci√≥n

```bash
# Copiar ejemplo
cp config/.env.example config/production.env

# Editar variables cr√≠ticas
# - SECRET_KEY: Generar clave segura
# - POSTGRES_PASSWORD: Contrase√±a fuerte
# - REDIS_PASSWORD: Contrase√±a Redis
# - DEBUG: false
```

## üß™ Testing

### Backend Tests

```bash
cd backend

# Ejecutar tests
pytest

# Con coverage
pytest --cov=app tests/

# Tests espec√≠ficos
pytest tests/test_predict.py -v
```

### Frontend Tests

```bash
cd frontend/web-app

# Ejecutar tests
npm test

# Con coverage
npm run test:coverage

# E2E tests
npm run test:e2e
```

### Tests de Integraci√≥n

```bash
# Docker test environment
docker-compose -f docker-compose.test.yml up -d

# Ejecutar tests de integraci√≥n
python -m pytest tests/integration/
```

## üîí Seguridad

### Autenticaci√≥n

- JWT tokens
- Refresh tokens
- Role-based access

### Validaci√≥n

- Input validation con Pydantic
- File upload restrictions
- Rate limiting

### Configuraci√≥n Segura

- HTTPS en producci√≥n
- CORS configurado
- Headers de seguridad

## ü§ù Contribuci√≥n

### Desarrollo

```bash
# 1. Fork del repositorio
# 2. Crear rama feature
git checkout -b feature/nueva-funcionalidad

# 3. Configurar pre-commit hooks (autom√°tico)
chmod +x infrastructure/scripts/setup-precommit.sh
./infrastructure/scripts/setup-precommit.sh

# 4. Hacer cambios y commit
git commit -m "feat: agregar nueva funcionalidad"

# 5. Push y crear PR
git push origin feature/nueva-funcionalidad
```

### Pre-commit Hooks

El proyecto incluye **hooks de pre-commit** para mantener la calidad del c√≥digo:

```bash
# Configuraci√≥n autom√°tica
./infrastructure/scripts/setup-precommit.sh

# Ejecuci√≥n manual
pre-commit run --all-files

# Actualizar hooks
pre-commit autoupdate

# Saltarse hooks temporalmente
git commit --no-verify
```

#### üîß Hooks Configurados

| Categor√≠a            | Herramientas                              | Prop√≥sito                           |
| -------------------- | ----------------------------------------- | ----------------------------------- |
| **üêç Python**        | Black, isort, Flake8, MyPy, Bandit        | Formateo, linting, tipos, seguridad |
| **üåê JavaScript**    | ESLint, Prettier                          | Linting y formateo                  |
| **üê≥ Docker**        | Hadolint                                  | Linting de Dockerfiles              |
| **üìù Documentaci√≥n** | Markdownlint                              | Formato de Markdown                 |
| **üîç General**       | YAML/JSON validation, trailing whitespace | Calidad general                     |
| **üß™ Tests**         | Pytest (tests r√°pidos)                    | Verificaci√≥n de funcionalidad       |
| **‚öôÔ∏è Personalizado** | Docstrings, env vars, package.json        | Verificaciones espec√≠ficas          |

### Est√°ndares de C√≥digo

- **Python**: Black, isort, flake8
- **TypeScript**: ESLint, Prettier
- **Commits**: Conventional commits
- **Documentaci√≥n**: Docstrings y comentarios

## üìö Recursos Adicionales

- [üìñ Documentaci√≥n API](http://localhost:8000/docs)
- [üìä Grafana Dashboards](http://localhost:3000)
- [üîß Admin Panel](http://localhost:3001)
- [üìà M√©tricas](http://localhost:8002)

## üìÑ Licencia

MIT License - ver [LICENSE](LICENSE) para detalles.

## üÜò Soporte

- **Issues**: [GitHub Issues](https://github.com/tu-usuario/ml-api-fastapi-v2/issues)
- **Documentaci√≥n**: Ver `/docs` en cada servicio
- **Wiki**: [GitHub Wiki](https://github.com/tu-usuario/ml-api-fastapi-v2/wiki)

---

‚≠ê **¬°Dale una estrella si te gusta el proyecto!** ‚≠ê
